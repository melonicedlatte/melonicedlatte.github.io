---
layout : article
title: "리눅스 서버에서 자동으로 지속적인 파일 백업 수행하기"
aside:
  toc: true
tags: Linux
category : Linux
author: melonicedlatte
published : True
hellogohn_num : 242
key : 2018-03-15-132041
--- 

<p>개인 웹 서버를 운용하는 상황에서는 백업이 굉장히 중요한 요소입니다.&nbsp;<br>대형 블로그 서비스들은 다 내부적으로 수행하고 있지만, 저는 수행하고 있지 않았는데 수행하는 방법에 대하여 알아보았습니다.&nbsp;</p><h1 class="site-title" style="margin-top: 0px; margin-bottom: 0px; padding: 0px; border: 0px; font-size: 24px; vertical-align: baseline; clear: both; line-height: 1.84615; color: rgb(68, 68, 68); font-family: &quot;Malgun Gothic&quot;, Helvetica, &quot;Apple SD Gothic Neo&quot;, Arial, sans-serif;"><a href="https://blog.lael.be/" title="Lael's World" rel="home" style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; transition: all 100ms linear; outline: none; color: rgb(81, 81, 81); display: inline-block; background-color: rgb(255, 239, 198);">Lael's World</a>&nbsp;님의 블로그 포스팅을 참조하여 수행하였습니다.</h1><p style="margin-top: 0px; margin-bottom: 0px; padding: 0px; border: 0px; font-size: 24px; vertical-align: baseline; clear: both; line-height: 1.84615; color: rgb(68, 68, 68); font-family: &quot;Malgun Gothic&quot;, Helvetica, &quot;Apple SD Gothic Neo&quot;, Arial, sans-serif;"><br></p><p>저는 일단 파일만 압축하여 디비도 함께 압축하여 저장하는 방식을 사용했습니다.<br>db 까지 따로 백업하려면, 경우에는 아래의 참조에서 링크를 타고 가시면 좋은 설명이 되어 있습니다.</p><p>저는 내장 DB sqlite3를 사용해서 해당 명령어는 필요 없다고 판단했습니다.&nbsp;<br>저는 블로그를 호스팅 하여 사용하기 때문에, 백업이 필요하다고 판단하여 백업을 미루다 미루다 오늘 포스팅 하게 됩니다.&nbsp;</p><p><br></p><p><span style="font-size: 24px; background-color: rgb(255, 239, 198);">- 백업할 디렉토리 및 저장 기간, 저장 방식 설정&nbsp;</span></p><p>저 같은 경우에는 블록 스토리지가 있어서 해당 스토리지에 저장하는 방식을 사용합니다.<br>백업의 경우에 해당 방식을 많이 사용하겠지만, 같은 디스크의 다른 폴더에 그냥 백업을 할 수도 있을 겁니다.&nbsp;</p><blockquote>$df -Th</blockquote><p>위의 명령어를 통해서 디스크의 여유 공간을 확인합니다.&nbsp;</p><p><br>저는 10GB의 스토리지를 보유하고 있고, 현재 한 번 압축하면 해당 파일이 차지하는 용량은 500MB 정도로 보여집니다.&nbsp;<br>따라서, 어느 정도 된 파일은 지속적으로 지워줘야 됩니다.&nbsp;<br>DB가 지속적으로 증가할 것을 고려하면 대략 하루에 한 번씩 백업하면, 14~15일 정도가 지금으로써는 적당한 것 같습니다.&nbsp;<br><br>블록 스토리지가 상대적으로 저렴하기 때문에, 비용을 2000원(제 호스팅 서비스) 정도 추가하면 보름 정도는 더 저장할 수 있는 것 같습니다.&nbsp;<br>스토리지 용량에 기간을 맞추는 것이 아니라, 원하는 기간에 맞춰서 알맞게 스토리지를 맞추는 것도 좋을 것 같습니다.&nbsp;</p><p><br></p><p><br>백업 방식의 종류로는 아래와 같은 방식이 있습니다. <br>저는 증분을 사용하고 싶지만, 지식이 부족하여 압축을 사용하기로 했습니다.</p><pre style="margin-top: 0px; margin-bottom: 24px; padding: 0px; border: 0px; font-size: 14px; vertical-align: baseline; line-height: 1.71429; color: rgb(68, 68, 68); font-family: &quot;Malgun Gothic&quot;, Helvetica, &quot;Apple SD Gothic Neo&quot;, Arial, sans-serif; margin-left: 25px;">-&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(0, 0, 255);">압축 백업</span>&nbsp;: (tar -czpf 백업) 일반적으로 많이 쓰이는 백업입니다. 이 작업에는&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; text-decoration-line: underline;">CPU 가 많이 사용됩니다</span>.<br>10GB 미만 압축이면 상관없는데 그 이상의 대용량의 압축 백업은 주의가 필요합니다. 백업 시켜놓고 CPU 사용량을 확인하세요.<br>-&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(0, 0, 255);">복사 백업</span>&nbsp;: (cp -R 백업) 압축하지 않고 복사만 합니다. 사용 용량을 많이 차지하지만 (압축하지 않는다는 뜻) 백업할 때 CPU 사용량이 크게 증가하지는 않습니다.<br>-&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; color: rgb(0, 0, 255);">증분 백업</span>&nbsp;: (rsync 백업) 변동사항만 비교하여 백업합니다. 비교를 위해서 파일은 항상 압축되지 않은 상태로 보관됩니다.</pre><p>어짜피 개인 블로그 목적의 백업이고, 새벽 시간을 이용하면 CPU 자원이 충분하기 때문이라고 생각해서입니다.&nbsp;<br></p><p><br><br>아래와 같이 정리해보았습니다.&nbsp;</p><pre>@ 백업 정책 @
보관 기간 : 14일
백업 방식 : 압축 백업
백업 시간 : 새벽 4시
백업 횟수 : 하루 1회
</pre><p><br><br><br><br>아래의 명령어에서 () 는 빼고 사용하셔야 합니다.&nbsp;<br></p><p>1) 백업할 폴더 생성 후 퍼미션 설정</p><blockquote>$ mkdir (백업하고 싶은 위치)<br>$ chmod 700 (백업하고 싶은 위치)</blockquote><p><br></p><p>2) 백업 스크립트 작성&nbsp;</p><blockquote>$ cd /root<br>$ vim backup.sh</blockquote><p style="margin-top: 0px; margin-bottom: 24px; padding: 0px; border: 0px; vertical-align: baseline; line-height: 1.71429;"><br>tar 명령어는 파일 압축 백업을 실시합니다.&nbsp;<br><br>find 관련 명령어는 10일이 지난 파일을 삭제합니다.&nbsp;<br>find 명령어 뒤에 파이프라인을 보면 rm 명령어를 확인하실 수 있습니다.&nbsp;<br>리눅스 명령어를 배우고, 활용을 안해봐서 직접 작성은 쉽지 않네요.&nbsp;<br><br>역시 명령어에서 괄호는 모두 제거하고 넣어주세요&nbsp;</p><p class="p1"><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span>1 </span><span class="s2">#!/bin/bash</span></p><p class="p2"><span class="s1"><span class="Apple-converted-space">&nbsp; </span>2 </span><span class="s2">tar </span><span class="s3">-czpf</span><span class="s2"> (백업할 디렉토리명)/(자신이 사용할 파일명).</span><span class="s3">`date +%Y%m%d%H%M%S`</span><span class="s2">.tgz (백업을 원하는 원하는 파일, 폴더)&nbsp;</span><span class="s4">1</span><span class="s1">&gt;</span><span class="s2">/dev/null </span><span class="s4">2</span><span class="s1">&gt;</span><span class="s2">/dev/null<br></span><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp;</span>3 find</span><span class="s2"> (백업할 디렉토리명)&nbsp;</span><span class="s3">-type</span><span class="s2"> f </span><span class="s3">-mtime</span><span class="s2"> +</span><span class="s4">14</span><span class="s2">&nbsp;| </span><span class="s1">sort</span><span class="s2"> | xargs </span><span class="s1">rm</span><span class="s2"> </span><span class="s3">-f</span></p><p><br><br>3) 백업 스크립트 퍼미션 설정 및 수행 확인&nbsp;</p><blockquote>$ chmod 700 backup.sh<br>$ ./backup.sh</blockquote><div>저는 테스트 결과 아래와 같이 파일이 잘 생성되었습니다.&nbsp;</div><p><img src="/system/uploads/images/000/000/691/original/image.png?1521086736" style="width: 658px;"><br></p><p><br></p><p><br></p><p>4) 주기적인 실행&nbsp;</p><blockquote>crontab -e</blockquote><p>위와 같은 명령어를 실행해서, 아래와 같이 명령어를 추가해줍니다.&nbsp;<br>4가 시간입니다.&nbsp; 24시간 기준이고 가령 오후 4시에 하고 싶으면 12를 더한 16을 사용하면 됩니다.&nbsp;</p><blockquote>0 4 * * * /root/backup.sh 1&gt;/dev/null 2&gt;/dev/null</blockquote><p class="p1"><span class="s1"><font color="#ffffff">#</font></span></p><p class="p1"><span class="s1"><font color="#ffffff"># For more information see the manual pages of crontab(5) and cron(8)</font></span></p><p class="p1"><span class="s1"><font color="#ffffff">#</font></span></p><p class="p1"><span class="s1"><font color="#ffffff"># m h<span class="Apple-converted-space">&nbsp; </span>dom mon dow <span class="Apple-converted-space">&nbsp; </span>command</font><br></span><span style="color: rgb(236, 236, 21); font-variant-ligatures: no-common-ligatures;">0 4 * * * /root/backup.sh 1&gt;/dev/null 2&gt;/dev/null</span></p><p><br></p><p><br>5) 확인해보자!<br></p><p>자고 일어나서 확인해보세요~&nbsp;</p><p><br><br>- 출처 -&nbsp;<br></p><p><a href="https://blog.lael.be/post/1449">https://blog.lael.be/post/1449</a>&nbsp;<br></p><style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Monaco; color: #28f0ef; background-color: #000000; background-color: rgba(0, 0, 0, 0.85)}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Monaco; color: #f4f4f4; background-color: #000000; background-color: rgba(0, 0, 0, 0.85)}
span.s1 {font-variant-ligatures: no-common-ligatures; color: #ecec15}
span.s2 {font-variant-ligatures: no-common-ligatures}
span.s3 {font-variant-ligatures: no-common-ligatures; color: #ffdddd}
span.s4 {font-variant-ligatures: no-common-ligatures; color: #ff3cff}
</style><style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Monaco; color: #f4f4f4; background-color: #000000; background-color: rgba(0, 0, 0, 0.85)}
span.s1 {font-variant-ligatures: no-common-ligatures}
</style>