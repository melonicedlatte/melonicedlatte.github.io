---
layout : article
title: "안드로이드에서 OpenCV 를 이용하여 이미지 영상처리하는 예제"
aside:
  toc: true
tags: Android
category : Android
author: melonicedlatte
published : True
hellogohn_num : 280
key : 2018-05-12-030916
--- 

<p><a href="http://melonicedlatte.com/post_one271">http://melonicedlatte.com/post_one271</a>&nbsp;링크에서 기본적인 세팅을 하고 오시면 됩니다!!<br></p><p><img src="/system/uploads/images/000/001/015/original/image.png?1526056878" style="width: 25%;"><br></p><p>1. src/main 에 assets 폴더가 없으면 추가시켜줍니다. 변경할 이미지를 아래와 같이 넣어줍니다. <br>(움직이는 gif 는 테스트해보니 작동하지 않습니다!! )</p><p><img src="/system/uploads/images/000/001/017/original/image.png?1526059225" style="width: 326px;"></p><p><br></p><p><br></p><p><br></p><p><br></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;">&lt;<span style="color:#000080;font-weight:bold;">uses-permission </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:name=</span><span style="color:#008000;font-weight:bold;">"android.permission.WRITE_EXTERNAL_STORAGE" </span>/&gt;</pre><p>2. 위의 permission을 Androidmanifest.xml 에 추가해줍니다. 방향 관련 소스코드는 제거합니다.&nbsp;</p><pre style="background-color: rgb(255, 255, 255); font-family: Menlo; font-size: 9pt;"><span style="color: rgb(0, 0, 0); font-style: italic;"><!--?</span--><span style="color: rgb(0, 0, 255); font-weight: bold;">xml version=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"1.0" </span><span style="color: rgb(0, 0, 255); font-weight: bold;">encoding=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"utf-8"</span><span style="color: rgb(0, 0, 0); font-style: italic;">?&gt;<br></span><font color="#000000">&lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">manifest </span><span style="color: rgb(0, 0, 255); font-weight: bold;">xmlns:</span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"http://schemas.android.com/apk/res/android"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">    </span><span style="color: rgb(0, 0, 255); font-weight: bold;">package=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"com.opencv.gohn.android_opencv"</span><font color="#000000">&gt;<br><br><br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">uses-permission </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.permission.CAMERA"</span><font color="#000000">/&gt;<br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">uses-feature </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.hardware.camera" </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:required=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"false"</span><font color="#000000">/&gt;<br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">uses-feature </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.hardware.camera.autofocus" </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:required=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"false"</span><font color="#000000">/&gt;<br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">uses-feature </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.hardware.camera.front" </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:required=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"false"</span><font color="#000000">/&gt;<br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">uses-feature </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.hardware.camera.front.autofocus"  </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:required=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"false"</span><font color="#000000">/&gt;</font><font color="#ff00ff"><br>    &lt;<span style="font-weight: bold;">uses-permission </span><span style="font-weight: bold;">android</span><span style="font-weight: bold;">:name=</span><span style="font-weight: bold;">"android.permission.WRITE_EXTERNAL_STORAGE" </span>/&gt;</font><font color="#000000"><br><br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">supports-screens </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:resizeable=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:smallScreens=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:normalScreens=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:largeScreens=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:anyDensity=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true" </span><font color="#000000">/&gt;<br><br><br>    &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">application<br></span><span style="color: rgb(0, 0, 128); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:allowBackup=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:icon=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"@mipmap/ic_launcher"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:label=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"@string/app_name"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:roundIcon=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"@mipmap/ic_launcher_round"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:supportsRtl=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"true"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">        </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:theme=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"@style/AppTheme"</span><font color="#000000">&gt;<br>        &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">activity </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">".MainActivity"<br></span><strike><font color="#ff00ff"><span style="font-weight: bold;">            </span><span style="font-weight: bold;">android</span><span style="font-weight: bold;">:screenOrientation=</span></font></strike><span style="font-weight: bold;"><strike style=""><font color="#ff00ff">"portrait"      &lt; 삭제 &gt;</font></strike><font color="#008000"><br></font></span><span style="color: rgb(0, 128, 0); font-weight: bold;">            </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:configChanges=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"keyboardHidden|orientation"<br></span><span style="color: rgb(0, 128, 0); font-weight: bold;">            </span><font color="#000000">&gt;<br>            &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">intent-filter</span><font color="#000000">&gt;<br>                &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">action </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.intent.action.MAIN" </span><font color="#000000">/&gt;<br><br>                &lt;</font><span style="color: rgb(0, 0, 128); font-weight: bold;">category </span><span style="color: rgb(102, 14, 122); font-weight: bold;">android</span><span style="color: rgb(0, 0, 255); font-weight: bold;">:name=</span><span style="color: rgb(0, 128, 0); font-weight: bold;">"android.intent.category.LAUNCHER" </span><font color="#000000">/&gt;<br>            <!--</font--><span style="color: rgb(0, 0, 128); font-weight: bold;">intent-filter</span><font color="#000000">&gt;<br>        <!--</font--><span style="color: rgb(0, 0, 128); font-weight: bold;">activity</span><font color="#000000">&gt;<br>    <!--</font--><span style="color: rgb(0, 0, 128); font-weight: bold;">application</span><font color="#000000">&gt;<br><br><!--</font--><span style="color: rgb(0, 0, 128); font-weight: bold;">manifest</span><font color="#000000">&gt;</font></font></font></font></font></span></pre><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><pre style="background-color: rgb(255, 255, 255); font-family: Menlo; font-size: 9pt;"><font color="#000000"><font color="#000000"><font color="#000000"># For more information about using CMake with Android Studio, read the<br># documentation: https://d.android.com/studio/projects/add-native-code.html<br><br># Sets the minimum version of CMake required to build the native library.<br><br>cmake_minimum_required(VERSION 3.4.1)<br><br><br>set(pathOPENCV /Users/imjaegon/programming/OpenCV-android-sdk)<br>set(pathPROJECT /Users/imjaegon/OneDrive/Documents/android/android_opencv)<br>set(pathLIBOPENCV_JAVA ${pathPROJECT}/app/src/main/JniLibs/${ANDROID_ABI}/libopencv_java3.so)<br><br>set(CMAKE_VERBOSE_MAKEFILE on)<br>set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=gnu++11")<br><br>include_directories(${pathOPENCV}/sdk/native/jni/include)<br><br><br># Creates and names a library, sets it as either STATIC<br># or SHARED, and provides the relative paths to its source code.<br># You can define multiple libraries, and CMake builds them for you.<br># Gradle automatically packages shared libraries with your APK.<br><br>add_library( # Sets the name of the library.<br>             native-lib<br><br>             # Sets the library as a shared library.<br>             SHARED<br><br>             # Provides a relative path to your source file(s).<br>             src/main/cpp/native-lib.cpp )<br><br># Searches for a specified prebuilt library and stores the path as a<br># variable. Because CMake includes system libraries in the search path by<br># default, you only need to specify the name of the public NDK library<br># you want to add. CMake verifies that the library exists before<br># completing its build.<br><br><br>add_library( lib_opencv SHARED IMPORTED )<br>set_target_properties(lib_opencv PROPERTIES IMPORTED_LOCATION ${pathLIBOPENCV_JAVA})<br><br><br>find_library( # Sets the name of the path variable.<br>              log-lib<br><br>              # Specifies the name of the NDK library that<br>              # you want CMake to locate.<br>              log )<br></font><font color="#ff00ff"><br>find_library( android-lib android)</font><font color="#000000"><br><br># Specifies libraries CMake should link to your target library. You<br># can link multiple libraries, such as libraries you define in this<br># build script, prebuilt third-party libraries, or system libraries.<br><br>target_link_libraries( # Specifies the target library.<br>                       native-lib<br><br>                       lib_opencv<br><br>                       # Links the target library to the log library<br>                       # included in the NDK.<br>                       ${log-lib}<br>                       </font><font color="#ff00ff">${android-lib}</font><font color="#000000"><br>                        )</font></font></font></pre><p><font color="#000000"><font color="#000000">3.&nbsp;app/CMakeLists.txt&nbsp; 파일에서 분홍색으로 표시된 부분을 추가합니다.</font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><font color="#000000"><font color="#000000"><span style="font-style:italic;"><!--?</span--><span style="color:#0000ff;font-weight:bold;">xml version=</span><span style="color:#008000;font-weight:bold;">"1.0" </span><span style="color:#0000ff;font-weight:bold;">encoding=</span><span style="color:#008000;font-weight:bold;">"utf-8"</span><span style="font-style:italic;">?&gt;<br></span>&lt;<span style="color:#000080;font-weight:bold;">LinearLayout </span><span style="color:#0000ff;font-weight:bold;">xmlns:</span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">=</span><span style="color:#008000;font-weight:bold;">"http://schemas.android.com/apk/res/android"<br></span><span style="color:#008000;font-weight:bold;">    </span><span style="color:#0000ff;font-weight:bold;">xmlns:</span><span style="color:#660e7a;font-weight:bold;">app</span><span style="color:#0000ff;font-weight:bold;">=</span><span style="color:#008000;font-weight:bold;">"http://schemas.android.com/apk/res-auto"<br></span><span style="color:#008000;font-weight:bold;">    </span><span style="color:#0000ff;font-weight:bold;">xmlns:</span><span style="color:#660e7a;font-weight:bold;">tools</span><span style="color:#0000ff;font-weight:bold;">=</span><span style="color:#008000;font-weight:bold;">"http://schemas.android.com/tools"<br></span><span style="color:#008000;font-weight:bold;">    </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_width=</span><span style="color:#008000;font-weight:bold;">"match_parent"<br></span><span style="color:#008000;font-weight:bold;">    </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_height=</span><span style="color:#008000;font-weight:bold;">"match_parent"<br></span><span style="color:#008000;font-weight:bold;">    </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:orientation=</span><span style="color:#008000;font-weight:bold;">"vertical"<br></span><span style="color:#008000;font-weight:bold;">    </span><span style="color:#660e7a;font-weight:bold;">tools</span><span style="color:#0000ff;font-weight:bold;">:context=</span><span style="color:#008000;font-weight:bold;">".MainActivity"</span>&gt;<br><br>    <span style="color:#808080;font-style:italic;"><!--<org.opencv.android.JavaCameraView--><br></span><span style="color:#808080;font-style:italic;">        <!--android:layout_width="match_parent"--><br></span><span style="color:#808080;font-style:italic;">        <!--android:layout_height="match_parent"--><br></span><span style="color:#808080;font-style:italic;">        <!--android:id="@+id/activity_surface_view" />--><br></span><span style="color:#808080;font-style:italic;"><br></span><span style="color:#808080;font-style:italic;">    </span>&lt;<span style="color:#000080;font-weight:bold;">ImageView<br></span><span style="color:#000080;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_width=</span><span style="color:#008000;font-weight:bold;">"match_parent" <br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_height=</span><span style="color:#008000;font-weight:bold;">"0dp"<br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_weight=</span><span style="color:#008000;font-weight:bold;">"1"<br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:id=</span><span style="color:#008000;font-weight:bold;">"@+id/imageViewInput"<br></span><span style="color:#008000;font-weight:bold;">        </span>/&gt;<br><br>    &lt;<span style="color:#000080;font-weight:bold;">ImageView<br></span><span style="color:#000080;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_width=</span><span style="color:#008000;font-weight:bold;">"match_parent"<br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_height=</span><span style="color:#008000;font-weight:bold;">"0dp"<br></span><span style="color:#008000;font-weight:bold;">        </span><span style="color:#660e7a;font-weight:bold;">android</span><span style="color:#0000ff;font-weight:bold;">:layout_weight=</span><span style="color:#008000;font-weight:bold;">"1<br></span><span style="color:#008000;font-weight:bold;">        android:id="</span>@+id/imageViewOutput"/&gt;<br><br><!--<span style="color:#000080;font-weight:bold;"-->LinearLayout</span>&gt;</font></font></pre><p><font color="#000000"><font color="#000000">4. activity_main.xml 파일에서 기존에 있던 내용은 주석처리하고 ImageView 를 2개 생성해서 넣습니다.&nbsp;</font></font></p><p><font color="#000000"><font color="#000000">전체 레이아웃을 LinearLayout으로 변경했습니다.</font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><font color="#000000"><font color="#000000"><span style="color:#000080;font-weight:bold;">package </span>com.opencv.gohn.android_opencv;<br><br><span style="color:#000080;font-weight:bold;">import </span>android.content.DialogInterface;<br><span style="color:#000080;font-weight:bold;">import </span>android.content.pm.PackageManager;<br><span style="color:#000080;font-weight:bold;">import </span>android.content.res.AssetManager;<br><span style="color:#000080;font-weight:bold;">import </span>android.graphics.Bitmap;<br><span style="color:#000080;font-weight:bold;">import </span>android.os.Build;<br><span style="color:#000080;font-weight:bold;">import </span>android.os.Environment;<br><span style="color:#000080;font-weight:bold;">import </span>android.support.v7.app.AlertDialog;<br><span style="color:#000080;font-weight:bold;">import </span>android.support.v7.app.AppCompatActivity;<br><span style="color:#000080;font-weight:bold;">import </span>android.os.Bundle;<br><span style="color:#000080;font-weight:bold;">import </span>android.util.Log;<br><span style="color:#000080;font-weight:bold;">import </span>android.widget.ImageView;<br><br><span style="color:#000080;font-weight:bold;">import </span>org.opencv.android.Utils;<br><span style="color:#000080;font-weight:bold;">import </span>org.opencv.core.Mat;<br><br><span style="color:#000080;font-weight:bold;">import </span>java.io.File;<br><span style="color:#000080;font-weight:bold;">import </span>java.io.FileOutputStream;<br><span style="color:#000080;font-weight:bold;">import </span>java.io.InputStream;<br><span style="color:#000080;font-weight:bold;">import </span>java.io.OutputStream;<br><br><span style="color:#000080;font-weight:bold;">public class </span>MainActivity <span style="color:#000080;font-weight:bold;">extends </span>AppCompatActivity{<br><br>    <span style="color:#000080;font-weight:bold;">static </span>{<br>        System.<span style="font-style:italic;">loadLibrary</span>(<span style="color:#008000;font-weight:bold;">"opencv_java3"</span>);<br>        System.<span style="font-style:italic;">loadLibrary</span>(<span style="color:#008000;font-weight:bold;">"native-lib"</span>);<br>    }<br><br>    ImageView <span style="color:#660e7a;font-weight:bold;">imageVIewInput</span>;<br>    ImageView <span style="color:#660e7a;font-weight:bold;">imageVIewOuput</span>;<br>    <span style="color:#000080;font-weight:bold;">private </span>Mat <span style="color:#660e7a;font-weight:bold;">img_input</span>;<br>    <span style="color:#000080;font-weight:bold;">private </span>Mat <span style="color:#660e7a;font-weight:bold;">img_output</span>;<br><br>    <span style="color:#000080;font-weight:bold;">private static final </span>String <span style="color:#660e7a;font-weight:bold;font-style:italic;">TAG </span>= <span style="color:#008000;font-weight:bold;">"opencv"</span>;<br>    <span style="color:#000080;font-weight:bold;">static final int </span><span style="color:#660e7a;font-weight:bold;font-style:italic;">PERMISSION_REQUEST_CODE </span>= <span style="color:#0000ff;">1</span>;<br>    String[] <span style="color:#660e7a;font-weight:bold;">PERMISSIONS  </span>= {<span style="color:#008000;font-weight:bold;">"android.permission.WRITE_EXTERNAL_STORAGE"</span>};<br><br>    <span style="color:#000080;font-weight:bold;">private boolean </span>hasPermissions(String[] permissions) {<br>        <span style="color:#000080;font-weight:bold;">int </span>ret = <span style="color:#0000ff;">0</span>;<br>        <span style="color:#808080;font-style:italic;">//스트링 배열에 있는 퍼미션들의 허가 상태 여부 확인<br></span><span style="color:#808080;font-style:italic;">        </span><span style="color:#000080;font-weight:bold;">for </span>(String perms : permissions){<br>            ret = checkCallingOrSelfPermission(perms);<br>            <span style="color:#000080;font-weight:bold;">if </span>(!(ret == PackageManager.<span style="color:#660e7a;font-weight:bold;font-style:italic;">PERMISSION_GRANTED</span>)){<br>                <span style="color:#808080;font-style:italic;">//퍼미션 허가 안된 경우<br></span><span style="color:#808080;font-style:italic;">                </span><span style="color:#000080;font-weight:bold;">return false</span>;<br>            }<br><br>        }<br>        <span style="color:#808080;font-style:italic;">//모든 퍼미션이 허가된 경우<br></span><span style="color:#808080;font-style:italic;">        </span><span style="color:#000080;font-weight:bold;">return true</span>;<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">private void </span>requestNecessaryPermissions(String[] permissions) {<br>        <span style="color:#808080;font-style:italic;">//마시멜로( API 23 )이상에서 런타임 퍼미션(Runtime Permission) 요청<br></span><span style="color:#808080;font-style:italic;">        </span><span style="color:#000080;font-weight:bold;">if </span>(Build.VERSION.<span style="color:#660e7a;font-weight:bold;font-style:italic;">SDK_INT </span>&gt;= Build.VERSION_CODES.<span style="color:#660e7a;font-weight:bold;font-style:italic;">M</span>) {<br>            requestPermissions(permissions, <span style="color:#660e7a;font-weight:bold;font-style:italic;">PERMISSION_REQUEST_CODE</span>);<br>        }<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">private void </span>copyFile(String filename) {<br>        String baseDir = Environment.<span style="font-style:italic;">getExternalStorageDirectory</span>().getPath();<br>        String pathDir = baseDir + File.<span style="color:#660e7a;font-weight:bold;font-style:italic;">separator </span>+ filename;<br><br>        AssetManager assetManager = <span style="color:#000080;font-weight:bold;">this</span>.getAssets();<br><br>        InputStream inputStream = <span style="color:#000080;font-weight:bold;">null</span>;<br>        OutputStream outputStream = <span style="color:#000080;font-weight:bold;">null</span>;<br><br>        <span style="color:#000080;font-weight:bold;">try </span>{<br>            Log.<span style="font-style:italic;">d</span>( <span style="color:#660e7a;font-weight:bold;font-style:italic;">TAG</span>, <span style="color:#008000;font-weight:bold;">"copyFile :: 다음 경로로 파일복사 "</span>+ pathDir);<br>            inputStream = assetManager.open(filename);<br>            outputStream = <span style="color:#000080;font-weight:bold;">new </span>FileOutputStream(pathDir);<br><br>            <span style="color:#000080;font-weight:bold;">byte</span>[] buffer = <span style="color:#000080;font-weight:bold;">new byte</span>[<span style="color:#0000ff;">1024</span>];<br>            <span style="color:#000080;font-weight:bold;">int </span>read;<br>            <span style="color:#000080;font-weight:bold;">while </span>((read = inputStream.read(buffer)) != -<span style="color:#0000ff;">1</span>) {<br>                outputStream.write(buffer, <span style="color:#0000ff;">0</span>, read);<br>            }<br>            inputStream.close();<br>            inputStream = <span style="color:#000080;font-weight:bold;">null</span>;<br>            outputStream.flush();<br>            outputStream.close();<br>            outputStream = <span style="color:#000080;font-weight:bold;">null</span>;<br>        } <span style="color:#000080;font-weight:bold;">catch </span>(Exception e) {<br>            Log.<span style="font-style:italic;">d</span>(<span style="color:#660e7a;font-weight:bold;font-style:italic;">TAG</span>, <span style="color:#008000;font-weight:bold;">"copyFile :: 파일 복사 중 예외 발생 "</span>+e.toString() );<br>        }<br><br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">public void </span>onRequestPermissionsResult(<span style="color:#000080;font-weight:bold;">int </span>permsRequestCode, String[] permissions, <span style="color:#000080;font-weight:bold;">int</span>[] grantResults){<br>        <span style="color:#000080;font-weight:bold;">switch</span>(permsRequestCode){<br><br>            <span style="color:#000080;font-weight:bold;">case </span><span style="color:#660e7a;font-weight:bold;font-style:italic;">PERMISSION_REQUEST_CODE</span>:<br>                <span style="color:#000080;font-weight:bold;">if </span>(grantResults.<span style="color:#660e7a;font-weight:bold;">length </span>&gt; <span style="color:#0000ff;">0</span>) {<br>                    <span style="color:#000080;font-weight:bold;">boolean </span>writeAccepted = grantResults[<span style="color:#0000ff;">1</span>] == PackageManager.<span style="color:#660e7a;font-weight:bold;font-style:italic;">PERMISSION_GRANTED</span>;<br><br>                    <span style="color:#000080;font-weight:bold;">if </span>(Build.VERSION.<span style="color:#660e7a;font-weight:bold;font-style:italic;">SDK_INT </span>&gt;= Build.VERSION_CODES.<span style="color:#660e7a;font-weight:bold;font-style:italic;">M</span>) {<br><br>                        <span style="color:#000080;font-weight:bold;">if </span>(!writeAccepted )<br>                        {<br>                            showDialogforPermission(<span style="color:#008000;font-weight:bold;">"앱을 실행하려면 퍼미션을 허가하셔야합니다."</span>);<br>                            <span style="color:#000080;font-weight:bold;">return</span>;<br>                        }<span style="color:#000080;font-weight:bold;">else<br></span><span style="color:#000080;font-weight:bold;">                        </span>{<br>                            read_image_file();<br>                            imageprocess_and_showResult();<br>                        }<br>                    }<br>                }<br>                <span style="color:#000080;font-weight:bold;">break</span>;<br>        }<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">private void </span>showDialogforPermission(String msg) {<br><br>        <span style="color:#000080;font-weight:bold;">final </span>AlertDialog.Builder myDialog = <span style="color:#000080;font-weight:bold;">new </span>AlertDialog.Builder(  MainActivity.<span style="color:#000080;font-weight:bold;">this</span>);<br>        myDialog.setTitle(<span style="color:#008000;font-weight:bold;">"알림"</span>);<br>        myDialog.setMessage(msg);<br>        myDialog.setCancelable(<span style="color:#000080;font-weight:bold;">false</span>);<br>        myDialog.setPositiveButton(<span style="color:#008000;font-weight:bold;">"예"</span>, <span style="color:#000080;font-weight:bold;">new </span>DialogInterface.OnClickListener() {<br>            <span style="color:#000080;font-weight:bold;">public void </span>onClick(DialogInterface arg0, <span style="color:#000080;font-weight:bold;">int </span>arg1) {<br>                <span style="color:#000080;font-weight:bold;">if </span>(Build.VERSION.<span style="color:#660e7a;font-weight:bold;font-style:italic;">SDK_INT </span>&gt;= Build.VERSION_CODES.<span style="color:#660e7a;font-weight:bold;font-style:italic;">M</span>) {<br>                    requestPermissions(<span style="color:#660e7a;font-weight:bold;">PERMISSIONS</span>, <span style="color:#660e7a;font-weight:bold;font-style:italic;">PERMISSION_REQUEST_CODE</span>);<br>                }<br><br>            }<br>        });<br>        myDialog.setNegativeButton(<span style="color:#008000;font-weight:bold;">"아니오"</span>, <span style="color:#000080;font-weight:bold;">new </span>DialogInterface.OnClickListener() {<br>            <span style="color:#000080;font-weight:bold;">public void </span>onClick(DialogInterface arg0, <span style="color:#000080;font-weight:bold;">int </span>arg1) {<br>                finish();<br>            }<br>        });<br>        myDialog.show();<br>    }<br><br>    <span style="color:#808000;">@Override<br></span><span style="color:#808000;">    </span><span style="color:#000080;font-weight:bold;">protected void </span>onCreate(Bundle savedInstanceState) {<br>        <span style="color:#000080;font-weight:bold;">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.<span style="color:#660e7a;font-weight:bold;font-style:italic;">activity_main</span>);<br><br>        <span style="color:#660e7a;font-weight:bold;">imageVIewInput </span>= (ImageView)findViewById(R.id.<span style="color:#660e7a;font-weight:bold;font-style:italic;">imageViewInput</span>);<br>        <span style="color:#660e7a;font-weight:bold;">imageVIewOuput </span>= (ImageView)findViewById(R.id.<span style="color:#660e7a;font-weight:bold;font-style:italic;">imageViewOutput</span>);<br><br>        <span style="color:#000080;font-weight:bold;">if </span>(!hasPermissions(<span style="color:#660e7a;font-weight:bold;">PERMISSIONS</span>)) { <span style="color:#808080;font-style:italic;">//퍼미션 허가를 했었는지 여부를 확인<br></span><span style="color:#808080;font-style:italic;">            </span>requestNecessaryPermissions(<span style="color:#660e7a;font-weight:bold;">PERMISSIONS</span>);<span style="color:#808080;font-style:italic;">//퍼미션 허가안되어 있다면 사용자에게 요청<br></span><span style="color:#808080;font-style:italic;">        </span>} <span style="color:#000080;font-weight:bold;">else </span>{<br>            <span style="color:#808080;font-style:italic;">//이미 사용자에게 퍼미션 허가를 받음.<br></span><span style="color:#808080;font-style:italic;">            </span>read_image_file();<br>            imageprocess_and_showResult();<br>        }<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">private void </span>imageprocess_and_showResult() {<br><br>        imageprocessing(<span style="color:#660e7a;font-weight:bold;">img_input</span>.getNativeObjAddr(), <span style="color:#660e7a;font-weight:bold;">img_output</span>.getNativeObjAddr());<br><br>        Bitmap bitmapInput = Bitmap.<span style="font-style:italic;">createBitmap</span>(<span style="color:#660e7a;font-weight:bold;">img_input</span>.cols(), <span style="color:#660e7a;font-weight:bold;">img_input</span>.rows(), Bitmap.Config.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ARGB_8888</span>);<br>        Utils.<span style="font-style:italic;">matToBitmap</span>(<span style="color:#660e7a;font-weight:bold;">img_input</span>, bitmapInput);<br>        <span style="color:#660e7a;font-weight:bold;">imageVIewInput</span>.setImageBitmap(bitmapInput);<br><br>        Bitmap bitmapOutput = Bitmap.<span style="font-style:italic;">createBitmap</span>(<span style="color:#660e7a;font-weight:bold;">img_output</span>.cols(), <span style="color:#660e7a;font-weight:bold;">img_output</span>.rows(), Bitmap.Config.<span style="color:#660e7a;font-weight:bold;font-style:italic;">ARGB_8888</span>);<br>        Utils.<span style="font-style:italic;">matToBitmap</span>(<span style="color:#660e7a;font-weight:bold;">img_output</span>, bitmapOutput);<br>        <span style="color:#660e7a;font-weight:bold;">imageVIewOuput</span>.setImageBitmap(bitmapOutput);<br>    }<br><br>    <span style="color:#000080;font-weight:bold;">private void </span>read_image_file() {<br>        copyFile(<span style="color:#008000;font-weight:bold;">"IU.jpg"</span>);<br><br>        <span style="color:#660e7a;font-weight:bold;">img_input </span>= <span style="color:#000080;font-weight:bold;">new </span>Mat();<br>        <span style="color:#660e7a;font-weight:bold;">img_output </span>= <span style="color:#000080;font-weight:bold;">new </span>Mat();<br><br>        loadImage(<span style="color:#008000;font-weight:bold;">"IU.jpg"</span>, <span style="color:#660e7a;font-weight:bold;">img_input</span>.getNativeObjAddr());<br>    }<br><br><br>    <span style="color:#808080;font-style:italic;">/**<br></span><span style="color:#808080;font-style:italic;">     * A native method that is implemented by the 'native-lib' native library,<br></span><span style="color:#808080;font-style:italic;">     * which is packaged with this application.<br></span><span style="color:#808080;font-style:italic;">     */<br></span><span style="color:#808080;font-style:italic;">    </span><span style="color:#000080;font-weight:bold;">public native void </span>loadImage(String imageFileName, <span style="color:#000080;font-weight:bold;">long </span>img);<br>    <span style="color:#000080;font-weight:bold;">public native void </span>imageprocessing(<span style="color:#000080;font-weight:bold;">long </span>inputImage, <span style="color:#000080;font-weight:bold;">long </span>outputImage);<br><br><br><br><br>}<br></font></font></pre><p><font color="#000000"><font color="#000000">5. MainActivity.java 파일을 수정해줍니다.&nbsp;</font></font></p><p><font color="#000000"><font color="#000000">위의 멤버들과 메소드들을 넣어줍니다.&nbsp;</font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><img src="/system/uploads/images/000/001/016/original/image.png?1526058993" style="width: 795px; height: 72.0109px;"><br></font></font></p><p><font color="#000000"><font color="#000000">6. 해당 메소드가 없어서 빨간 글자가 뜨게 됩니다.&nbsp;<br>링크를 클릭해서 메소드를 생성한 다음 native-lib.cpp 내용을 넣어주어야 합니다.&nbsp;</font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><font color="#000000"><font color="#000000"><span style="color:#808000;">#include </span><span style="color:#008000;font-weight:bold;"><jni.h><br></jni.h></span><span style="color:#808000;">#include </span><span style="color:#008000;font-weight:bold;"><opencv2 opencv.hpp=""><br></opencv2></span><span style="color:#808000;">#include </span><span style="color:#008000;font-weight:bold;"><android asset_manager_jni.h=""><br></android></span><span style="color:#008000;font-weight:bold;"><br></span><span style="color:#000080;font-weight:bold;">using namespace </span><span style="color:#008080;">cv</span>;<br><span style="color:#000080;font-weight:bold;">using namespace </span><span style="color:#008080;">std</span>;<br><br><span style="color:#000080;font-weight:bold;">extern </span><span style="color:#008000;font-weight:bold;">"C"<br></span><span style="color:#1f542e;font-weight:bold;">JNIEXPORT </span><span style="color:#000080;font-weight:bold;">void </span><span style="color:#1f542e;font-weight:bold;">JNICALL<br></span>Java_com_opencv_gohn_android_1opencv_MainActivity_loadImage(<span style="color:#371f80;">JNIEnv </span>*env, <span style="color:#371f80;">jobject </span>instance,<br>                                                            <span style="color:#371f80;">jstring </span>imageFileName_, <span style="color:#371f80;">jlong </span>img) {<br>    <span style="color:#000080;font-weight:bold;">const char </span>*imageFileName = env-&gt;GetStringUTFChars(imageFileName_, <span style="color:#0000ff;">0</span>);<br><br>    <span style="color:#808080;font-style:italic;">// </span><span style="color:#0073bf;font-weight:bold;font-style:italic;">TODO<br></span><span style="color:#0073bf;font-weight:bold;font-style:italic;"><br></span><span style="color:#0073bf;font-weight:bold;font-style:italic;">    </span><span style="color:#008080;">Mat </span>&amp;img_input = *(<span style="color:#008080;">Mat </span>*) img;<br><br>    <span style="color:#000080;font-weight:bold;">const char </span>*nativeFileNameString = env-&gt;GetStringUTFChars(imageFileName_, <span style="color:#1f542e;font-weight:bold;">JNI_FALSE</span>);<br><br>    <span style="color:#371f80;">string </span>baseDir(<span style="color:#008000;font-weight:bold;">"/storage/emulated/0/"</span>);<br>    baseDir.append(nativeFileNameString);<br>    <span style="color:#000080;font-weight:bold;">const char </span>*pathDir = baseDir.c_str();<br><br>    img_input <span style="color:#008080;">= </span>imread(pathDir, <span style="color:#660e7a;font-weight:bold;font-style:italic;">IMREAD_COLOR</span>);<br>}<br><br><span style="color:#000080;font-weight:bold;">extern </span><span style="color:#008000;font-weight:bold;">"C"<br></span><span style="color:#1f542e;font-weight:bold;">JNIEXPORT </span><span style="color:#000080;font-weight:bold;">void </span><span style="color:#1f542e;font-weight:bold;">JNICALL<br></span>Java_com_opencv_gohn_android_1opencv_MainActivity_imageprocessing(<span style="color:#371f80;">JNIEnv </span>*env, <span style="color:#371f80;">jobject </span>instance,<br>                                                                  <span style="color:#371f80;">jlong </span>inputImage,<br>                                                                  <span style="color:#371f80;">jlong </span>outputImage) {<br><br>    <span style="color:#808080;font-style:italic;">// </span><span style="color:#0073bf;font-weight:bold;font-style:italic;">TODO<br></span><span style="color:#0073bf;font-weight:bold;font-style:italic;">    </span><span style="color:#008080;">Mat </span>&amp;img_input = *(<span style="color:#008080;">Mat </span>*) inputImage;<br>    <span style="color:#008080;">Mat </span>&amp;img_output = *(<span style="color:#008080;">Mat </span>*) outputImage;<br><br>    cvtColor( img_input, img_input, <span style="color:#660e7a;font-weight:bold;font-style:italic;">CV_BGR2RGB</span>);<br>    cvtColor( img_input, img_output, <span style="color:#660e7a;font-weight:bold;font-style:italic;">CV_RGB2GRAY</span>);<br>    blur( img_output, img_output, <span style="color:#371f80;">Size</span>(<span style="color:#0000ff;">5</span>,<span style="color:#0000ff;">5</span>) );<br>    Canny( img_output, img_output, <span style="color:#0000ff;">50</span>, <span style="color:#0000ff;">150</span>, <span style="color:#0000ff;">5 </span>);<br><br>}</font></font></pre><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000"><br></font></font></p><p><font color="#000000"><font color="#000000">수행 결과 아래와 같이 잘 나타나게 됩니다 !!&nbsp;</font></font></p><p><font color="#000000"><font color="#000000"><img src="/system/uploads/images/000/001/018/original/Screenshot_2018-05-12-03-04-44.png?1526062076" style="width: 25%;"><br></font></font></p><p><br></p><p><font color="#000000"><font color="#000000">- 출처 -<br><a href="http://webnautes.tistory.com/1090">http://webnautes.tistory.com/1090</a>&nbsp;<br>http://melonicedlatte.com/post_one271<br><br></font></font></p>